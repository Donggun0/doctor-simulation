<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì˜ì‚¬ í•´ë³´ë˜ê°€ (Try Being a Doctor)</title>
    <link rel="stylesheet" href="main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <style>
        /* CRITICAL CSS for Intro Overlay */
        .intro-doctor-img {
            width: 120px !important;
            height: 120px !important;
            border-radius: 50% !important;
            object-fit: cover !important;
            border: 3px solid #00b894 !important;
        }

        .modal {
            max-width: 90% !important;
            padding: 2rem !important;
            background: #2d3436 !important;
            border-radius: 16px !important;
            text-align: center !important;
        }

        .modal-overlay {
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.9);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5000;
        }

        .modal-overlay.hidden {
            display: none !important;
        }
    </style>
</head>

<body>
    <div class="game-wrapper">
        <aside class="waiting-room">
            <div class="wr-header">
                <h2>ëŒ€ê¸°ì‹¤ í˜„í™©</h2>
                <div class="wr-count">ëŒ€ê¸°: <span id="waiting-count">0</span>ëª…</div>
            </div>
            <ul id="waiting-list" class="patient-list">
                <!-- Names injected here -->
            </ul>
            <div class="wr-status" id="wr-status">í‰í™”ë¡­ìŠµë‹ˆë‹¤</div>

            <!-- Doctor Area -->
            <div class="doctor-sidebar-container" id="doctor-container">
                <div class="doctor-avatar-container">
                    <img src="assets/doctor.png" alt="Doctor" id="doctor-img">
                    <div id="doctor-emoji" class="reaction-emoji">ğŸ’¬</div>
                </div>
                <!-- Bubble outside container for visibility -->
                <div id="hint-bubble" class="hidden">íŒíŠ¸...</div>

                <div class="doctor-info-mini">
                    <div class="revenue-display">
                        <span id="revenue-amount">0</span>
                        <span class="currency">â‚©</span>
                    </div>
                </div>
            </div>

        </aside>

        <div class="app-container">
            <header>
                <div class="top-bar">
                    <div class="header-left">
                        <h1>ì˜ì‚¬ í•´ë³´ë˜ê°€ <span class="day-counter">Day <span id="day-display">1</span></span></h1>
                    </div>
                    <div class="header-right">
                        <div class="goal-display">
                            <span class="goal-label">ì˜¤ëŠ˜ì˜ ì§„ë£Œ</span>
                            <span id="patient-count">0</span> / <span id="goal-count">20</span>
                        </div>
                        <button id="admin-btn" class="icon-btn" aria-label="Admin">ğŸ› ï¸</button>
                        <button id="tutorial-btn" class="icon-btn" aria-label="Tutorial">â“</button>
                    </div>
                </div>

                <!-- Compact Status Board -->
                <div class="status-board compact">
                    <div class="stat-item tooltip">
                        <span class="icon">â¤ï¸</span>
                        <div class="mini-bar">
                            <div id="hp-bar" class="fill" style="width:100%"></div>
                        </div>
                    </div>
                    <div class="stat-item tooltip">
                        <span class="icon">ğŸ§ </span>
                        <div class="mini-bar">
                            <div id="mental-bar" class="fill" style="width:100%"></div>
                        </div>
                    </div>
                    <div class="stat-item tooltip">
                        <span class="icon">âš–ï¸</span>
                        <div class="mini-bar">
                            <div id="admin-bar" class="fill risk" style="width:0%"></div>
                        </div>
                    </div>
                    <div class="stat-item tooltip">
                        <span class="icon">â­</span>
                        <div class="mini-bar">
                            <div id="satisfaction-bar" class="fill warning" style="width:50%"></div>
                        </div>
                    </div>
                </div>
            </header>

            <main id="game-stage">
                <div class="patient-visual">
                    <!-- Left Column: Image -->
                    <div class="img-column">
                        <div class="timer-wrapper">
                            <span class="timer-hourglass">â³</span>
                            <div class="timer-bar-container">
                                <div id="patient-timer" class="timer-fill"></div>
                            </div>
                        </div>
                        <div id="patient-img" class="character-img" role="img" aria-label="Patient Character"></div>
                    </div>
                </div>

                <div class="info-column">
                    <!-- Dialogue Only -->
                    <div class="dialogue-box">
                        <p id="patient-dialogue">"..."</p>
                        <div class="narrator-box" id="narrator-text"></div>
                    </div>
                </div>
            </main>

            <footer id="action-area">
                <div class="choices-container" id="choices-container">
                    <button class="choice-btn">ì²˜ë°©í•œë‹¤</button>
                    <button class="choice-btn">ê±°ì ˆí•˜ê³  ì„¤ëª…í•œë‹¤</button>
                </div>
            </footer>
        </div>

        <!-- Patient Chart Sidebar -->
        <div class="patient-chart" id="sidebar-chart">
            <div class="chart-header">
                <span id="p-name">-</span>
                <span id="p-info">(-/-)</span>
            </div>
            <div class="chart-body">
                <div class="vital-row"><span class="label">BP</span> <span id="p-bp" class="val">-/-</span></div>
                <div class="vital-row"><span class="label">HR</span> <span id="p-hr" class="val">-</span></div>
                <div class="vital-row"><span class="label">BT</span> <span id="p-bt" class="val">-</span></div>
                <div class="history-row">
                    <span class="label">íŠ¹ì´ì‚¬í•­</span>
                    <span id="p-history" class="val warning-text">-</span>
                </div>
            </div>
        </div>
    </div> <!-- end game-wrapper -->

    <!-- Overlays -->
    <div id="intro-overlay" class="modal-overlay">
        <div class="modal intro-content">
            <div class="intro-header">
                <img src="assets/doctor.png" alt="Doctor" class="intro-doctor-img"
                    style="width: 120px; height: 120px; object-fit: cover; border-radius: 50%;">
                <h2>ì›”ìš”ì¼ ì•„ì¹¨ 8ì‹œ 55ë¶„</h2>
            </div>
            <div class="intro-text">
                <p>"í•˜ì•„..."</p>
                <p>ê¹Šì€ í•œìˆ¨ê³¼ í•¨ê»˜ ë¯¹ìŠ¤ì»¤í”¼ë¥¼ í„¸ì–´ ë„£ëŠ”ë‹¤.</p>
                <p><strong>ê°œì› ëŒ€ì¶œ ê¸ˆë¦¬ 6.5%</strong>. ì´ë²ˆ ë‹¬ ì„ëŒ€ë£Œì™€ ì§ì› ì›”ê¸‰ì„ ë§ì¶”ë ¤ë©´...</p>
                <p class="highlight">ì˜¤ëŠ˜ ìµœì†Œ <span class="accent">20ëª…</span>ì€ ë´ì•¼ ì ìë¥¼ ë©´í•œë‹¤.</p>
                <p>ë°–ì—ì„œ í™˜ìë“¤ì˜ ì›…ì„±ê±°ë¦¬ëŠ” ì†Œë¦¬ê°€ ë“¤ë ¤ì˜¨ë‹¤.</p>
            </div>
            <button id="start-game-btn" class="primary-btn pulse">ì§„ë£Œ ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>

    <!-- Tutorial Modal -->
    <div id="tutorial-modal" class="hidden">
        <div class="modal tutorial-content">
            <h2><span class="icon">ğŸ“‹</span> ì§„ë£Œ ê°€ì´ë“œ</h2>
            <div class="tutorial-grid">
                <div class="t-item">
                    <span class="t-icon">â¤ï¸</span>
                    <div class="t-desc">
                        <strong>ì²´ë ¥ (HP)</strong>
                        <p>0ì´ ë˜ë©´ ê³¼ë¡œë¡œ ì“°ëŸ¬ì§‘ë‹ˆë‹¤. (ë²ˆì•„ì›ƒ ì—”ë”©)</p>
                    </div>
                </div>
                <div class="t-item">
                    <span class="t-icon">ğŸ§ </span>
                    <div class="t-desc">
                        <strong>ë©˜íƒˆ (Mental)</strong>
                        <p>ì§„ìƒ í™˜ìì—ê²Œ í„¸ë¦¬ë©´ ê°ì†Œ. 0ì´ ë˜ë©´ ë¯¸ì³ë²„ë¦½ë‹ˆë‹¤.</p>
                    </div>
                </div>
                <div class="t-item">
                    <span class="t-icon">âš–ï¸</span>
                    <div class="t-desc">
                        <strong>í–‰ì • ë¦¬ìŠ¤í¬</strong>
                        <p>í¸ë²•/ë¶ˆë²• ì²˜ë°© ì‹œ ì¦ê°€. 100ì´ ë˜ë©´ ê°ì‚¬ê°€ ë‚˜ì˜µë‹ˆë‹¤.</p>
                    </div>
                </div>
                <div class="t-item">
                    <span class="t-icon">â­</span>
                    <div class="t-desc">
                        <strong>í™˜ì ë§Œì¡±ë„</strong>
                        <p>ë„ˆë¬´ ë‚®ìœ¼ë©´ ë‚œë™ì„ ë¶€ë¦¬ì§€ë§Œ, ë†’ë‹¤ê³  ëˆì´ ë˜ì§„ ì•ŠìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
            <div class="tutorial-footer">
                <p>â€» ëª¨ë“  ì„ íƒì€ ë‹¹ì‹ ì˜ ì±…ì„ì…ë‹ˆë‹¤. í–‰ìš´ì„ ë¹•ë‹ˆë‹¤, ì›ì¥ë‹˜.</p>
                <button id="close-tutorial" class="primary-btn">ê°€ì´ë“œ ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <!-- Overlays for Endings -->
    <div id="overlay" class="hidden">
        <div class="modal">
            <h2 id="ending-title">ê²Œì„ ì˜¤ë²„</h2>
            <p id="ending-desc">...</p>
            <p class="disclaimer">â€» ì´ ê²Œì„ì˜ ì–´ë–¤ ê²°ê³¼ë„ ì˜ë£Œ ê³¼ì‹¤ì„ ì˜ë¯¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
            <button id="restart-btn" class="primary-btn">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>

    <!-- Admin Mode Overlay -->
    <div id="admin-mode-overlay" class="hidden">
        <div class="admin-panel">
            <div class="admin-header">
                <h2>ğŸ› ï¸ ì‹œë‚˜ë¦¬ì˜¤ í¸ì§‘ê¸° (Admin)</h2>
                <button id="close-admin">X</button>
            </div>
            <div class="admin-content">
                <div class="scenario-list-panel">
                    <h3>Case List</h3>
                    <ul id="admin-scenario-list"></ul>
                    <button id="add-scenario-btn" class="secondary-btn">+ New Case</button>
                </div>
                <div class="editor-panel">
                    <h3>Editor</h3>
                    <div id="editor-form">
                        <label>ID: <input type="text" id="edit-id" readonly></label>
                        <label>Image Path: <input type="text" id="edit-image"></label>
                        <label>Dialog: <textarea id="edit-text"></textarea></label>
                        <label>Age: <input type="number" id="edit-age"></label>
                        <label>Gender: <select id="edit-gender">
                                <option value="M">M</option>
                                <option value="F">F</option>
                            </select></label>
                        <label>BP: <input type="text" id="edit-bp"></label>
                        <label>HR: <input type="number" id="edit-hr"></label>
                        <label>BT: <input type="number" step="0.1" id="edit-bt"></label>
                        <div id="edit-choices-list"></div>
                        <button id="save-scenario-btn" class="primary-btn">Save Changes</button>
                        <button id="export-data-btn" class="secondary-btn">Export data.js</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script src="scenario_manager.js"></script>
    <script src="game.js"></script>
</body>

</html>